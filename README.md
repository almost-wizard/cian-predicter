# üèôÔ∏è SPb Rental Price Predicter (by Cian)

<div align="center">
  <img src="https://img.shields.io/badge/Python-3.10+-blue?style=for-the-badge&logo=python&logoColor=white" alt="Python">
  <img src="https://img.shields.io/badge/FastAPI-0.109+-009688?style=for-the-badge&logo=fastapi&logoColor=white" alt="FastAPI">
  <img src="https://img.shields.io/badge/CatBoost-1.2+-yellow?style=for-the-badge&logo=catboost&logoColor=black" alt="CatBoost">
  <img src="https://img.shields.io/badge/Docker-Enabled-2496ED?style=for-the-badge&logo=docker&logoColor=white" alt="Docker">
</div>

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [üèôÔ∏è SPb Rental Price Predicter (by Cian)](#Ô∏è-spb-rental-price-predicter-by-cian)
  - [üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#-—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)
  - [üìù –û–ø–∏—Å–∞–Ω–∏–µ](#-–æ–ø–∏—Å–∞–Ω–∏–µ)
    - [‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#-–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
    - [üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#Ô∏è-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
    - [üîÆ ML –∏ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å](#-ml-–∏-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å)
  - [üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
    - [üê≥ Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)](#-docker-—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
    - [üêç –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫](#-–ª–æ–∫–∞–ª—å–Ω—ã–π-–∑–∞–ø—É—Å–∫)
  - [üîå API Reference](#-api-reference)
    - [–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞](#–ø—Ä–∏–º–µ—Ä-–∑–∞–ø—Ä–æ—Å–∞)
    - [–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞](#–ø—Ä–∏–º–µ—Ä-–æ—Ç–≤–µ—Ç–∞)
  - [üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
  - [üåø –í–µ—Ç–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#-–≤–µ—Ç–∫–∏-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

## üìù –û–ø–∏—Å–∞–Ω–∏–µ

**Cian Price Predicter** ‚Äî —ç—Ç–æ ML-—Å–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã –∫–≤–∞—Ä—Ç–∏—Ä –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ. –°–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–ø–ª–æ—â–∞–¥—å, —ç—Ç–∞–∂, —Ä–µ–º–æ–Ω—Ç, —É–¥–æ–±—Å—Ç–≤–∞, –æ–ø–∏—Å–∞–Ω–∏–µ) –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Ä—ã–Ω–æ—á–Ω—É—é —Ü–µ–Ω—É, –∞ —Ç–∞–∫–∂–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç "–≤—ã–≥–æ–¥–Ω–æ—Å—Ç—å" –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.

### ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üéØ **–¢–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –±—É—Å—Ç–∏–Ω–≥ (CatBoostRegressor) –æ–±—É—á–µ–Ω–Ω—ã–π –Ω–∞ —Ç—ã—Å—è—á–∞—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π.
- üìâ **–û—Ü–µ–Ω–∫–∞ –≤—ã–≥–æ–¥–Ω–æ—Å—Ç–∏**: –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–µ–¥–æ–æ—Ü–µ–Ω–µ–Ω–Ω–æ—Å—Ç–∏.
- üìä **–î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω**: –í—ã–¥–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–æ—á–µ—á–Ω—É—é –æ—Ü–µ–Ω–∫—É, –Ω–æ –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π –∫–æ—Ä–∏–¥–æ—Ä —Ü–µ–Ω.
- üß† **Explainable AI (SHAP)**: –û–±—ä—è—Å–Ω—è–µ—Ç –∫–∞–∂–¥–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ, –ø–æ–∫–∞–∑—ã–≤–∞—è —Ç–æ–ø —Ñ–∞–∫—Ç–æ—Ä–æ–≤, –ø–æ–≤–ª–∏—è–≤—à–∏—Ö –Ω–∞ —Ü–µ–Ω—É.
- ‚ö° **High Performance**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API –Ω–∞ FastAPI, –ø–∞–π–ø–ª–∞–π–Ω —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

### üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Backend**: Python 3.10, FastAPI, Pydantic v2
- **ML Core**: CatBoost, SHAP, Scikit-learn, Numpy
- **Deployment**: Docker, Docker Compose
- **Logging**: Loguru

### üîÆ ML –∏ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å

–ú–æ–¥–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ **43 –ø—Ä–∏–∑–Ω–∞–∫–∞**, –≤–∫–ª—é—á–∞—è:
- üó∫Ô∏è **–ì–µ–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é**: –†–∞–π–æ–Ω (OHE), —É–¥–∞–ª–µ–Ω–Ω–æ—Å—Ç—å –æ—Ç –º–µ—Ç—Ä–æ.
- üè† **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**: –ü–ª–æ—â–∞–¥—å, —ç—Ç–∞–∂, —Ç–∏–ø –¥–æ–º–∞, –≥–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏.
- üõãÔ∏è **–£–¥–æ–±—Å—Ç–≤–∞**: –ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ç–µ–≥–æ–≤ (–ø–æ—Å—É–¥–æ–º–æ–π–∫–∞, –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä, –º–µ–±–µ–ª—å).
- üíé **–°–æ—Å—Ç–æ—è–Ω–∏–µ**: –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ä–µ–º–æ–Ω—Ç–∞ (–∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–π, –µ–≤—Ä–æ, –¥–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π).

## üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### üê≥ Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**:
   ```bash
   git clone https://github.com/almost-wizard/cian-predicter.git
   cd cian-predicter
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å**:
   ```bash
   docker-compose up --build
   ```

3. **–ì–æ—Ç–æ–≤–æ!** API –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8000`
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Swagger): `http://localhost:8000/docs`

### üêç –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ**:
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
   ```bash
   pip install .
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä**:
   ```bash
   uvicorn app.main:app --reload
   ```

## üîå API Reference

–û—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç: `POST /api/v1/predict`

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "title": "–£—é—Ç–Ω–∞—è 2-–∫ –∫–≤–∞—Ä—Ç–∏—Ä–∞ –Ω–∞ –ù–µ–≤—Å–∫–æ–º",
  "price_per_month": 55000,
  "address": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 100",
  "features": {
    "total_area": 52.5,
    "floor_number": 3,
    "total_floors_cnt": 5,
    "metro_nearest_time": 5,
    "repair_cat": "–ï–≤—Ä–æ—Ä–µ–º–æ–Ω—Ç",
    "house_type_cat": "–ö–∏—Ä–ø–∏—á–Ω—ã–π",
    "build_year": 1905,
    "hcs_price": "5000 ‚ÇΩ",
    "balcony_loggia_cnt": "1 –±–∞–ª–∫"
  },
  "facts": ["internet", "ac"]
}
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "predictions": [
    {
      "predicted_price": 62000,
      "price_range_low": 52700,
      "price_range_high": 71300,
      "undervalued_percent": 11.3,
      "feature_contributions": [
        {
          "feature_name": "total_area",
          "influence": 0.14,
        },
        {
          "feature_name": "district_moskovsky_flg",
          "influence": -0.03,
        }
      ]
    }
  ]
}
```

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
cian-predicter/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/             # API Endpoints & DI
‚îÇ   ‚îú‚îÄ‚îÄ core/            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ models/          # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model_service.py       # –û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ CatBoost & SHAP
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prediction_service.py  # –õ–æ–≥–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transformer_service.py # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ main.py          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îú‚îÄ‚îÄ models/              # –ë–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –º–æ–¥–µ–ª–µ–π (.cbm)
‚îú‚îÄ‚îÄ tests/               # Pytest —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ pyproject.toml
```

## üåø –í–µ—Ç–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–ü—Ä–æ–µ–∫—Ç –≤–µ–¥–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–µ—Ç–∫–∞—Ö, –æ—Ç–≤–µ—á–∞—é—â–∏—Ö –∑–∞ —Ä–∞–∑–Ω—ã–µ —ç—Ç–∞–ø—ã ML-—Ü–∏–∫–ª–∞:
- `master` ‚Äî –°—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å–µ—Ä–≤–∏—Å–∞.
- `parser` ‚Äî –ö–æ–¥ –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å Cian.
- `dataset-analyze` ‚Äî EDA, –Ω–æ—É—Ç–±—É–∫–∏ —Å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö.
- `ml-impl` ‚Äî –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å –æ–±—É—á–µ–Ω–∏–µ–º –º–æ–¥–µ–ª–µ–π, –ø–æ–¥–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
- `api` ‚Äî –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±—ç–∫–µ–Ω–¥–∞.

---
‚≠ê –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∑–≤–µ–∑–¥—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è –ø—Ä–æ–µ–∫—Ç!
